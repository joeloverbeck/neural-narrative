{% extends 'base.html' %}

{% block title %}Chat{% endblock %}

{% block styles %}
{{super()}}
<link href="{{ url_for('static', filename='chat.css') }}" rel="stylesheet" type="text/css">
{% endblock %}

{% block content %}
<div class="chat-container">
    <h1 class="page-title"><i class="fas fa-comments"></i> Chat</h1>

    <!-- Info Bar -->
    <div class="info-bar">
        <div class="current-time">
            Time: {{ current_time }}
        </div>
        <div class="current-place">
            Place: {{ current_place_template }}
        </div>
    </div>

    <!-- Chat Window -->
    <div class="chat-window" id="chat-window">
        {% for message in dialogue %}
        {% if message.alignment == 'center' %}
        {% if message.message_type == 'ambient' %}
        <!-- Ambient Message -->
        <div class="ambient-message" data-file-url="{{ message.file_url }}">
            <div class="ambient-message-text">{{ message.message_text }}</div>
            <i class="fas fa-play play-icon"></i>
            <div class="waveform">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
        {% elif message.message_type == 'event' %}
        <!-- Event Message -->
        <div class="event-message" data-file-url="{{ message.file_url }}">
            <div class="event-message-text">{{ message.message_text }}</div>
            <i class="fas fa-play play-icon"></i>
            <div class="waveform">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
        {% endif %}
        {% else %}
        <!-- Chat Bubble -->
        <div class="chat-bubble {{ message.alignment }}" data-file-url="{{ message.file_url }}">
            <img alt="{{ message.sender_name }}" class="avatar" src="{{ message.sender_photo_url }}">
            <div class="message-content">
                <div class="sender-label">{{ message.sender_name }}</div>
                <div class="message-text">{{ message.message_text }}</div>
            </div>
            <i class="fas fa-play play-icon"></i>
            <div class="waveform">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>

    <!-- Chat Form -->
    <form method="post" class="chat-form ajax-form" action="{{ url_for('chat') }}"
          data-success-handler="chatSuccessHandler" data-error-handler="chatErrorHandler">
        <input id="user-input" name="user_input" placeholder="Type your message here..." type="text">
        <div class="form-buttons">
            <button type="submit" name="submit_action" value="Send" class="icon-button" id="send-message-button"
                    title="Send Message">
                <i class="fas fa-paper-plane"></i>
            </button>
            <button type="submit" name="submit_action" value="Ambient narration" class="icon-button"
                    id="ambient-narration-button" title="Ambient Narration">
                <i class="fa-solid fa-tree-city"></i>
            </button>
            <button type="submit" name="submit_action" value="Narrative beat" class="icon-button"
                    id="narrative-beat-button" title="Narrative Beat">
                <i class="fa-solid fa-person-walking-arrow-right"></i>
            </button>
        </div>
    </form>

    <!-- Event Form -->
    <form method="post" class="event-form ajax-form" action="{{ url_for('chat') }}"
          data-success-handler="chatSuccessHandler" data-error-handler="chatErrorHandler">
        <input id="event-input" name="event_input" placeholder="Describe an event..." type="text">
        <div class="form-buttons">
            <button type="submit" name="submit_action" value="Event" class="icon-button"
                    id="event-button" title="Event">
                <i class="fa-solid fa-person-circle-exclamation"></i>
            </button>
        </div>
    </form>

    <!-- Navigation Buttons -->
    <div class="buttons">
        <a href="{{ url_for('index') }}" class="button">
            <i class="fa-solid fa-dungeon"></i> Home
        </a>
        <a href="{{ url_for('places') }}" class="button">
            <i class="fas fa-map"></i> Places
        </a>
        <a href="{{ url_for('story-hub') }}" class="button">
            <i class="fas fa-feather-alt"></i> Story Hub
        </a>
        <a href="{{ url_for('characters-hub') }}" class="button">
            <i class="fas fa-users"></i> Characters Hub
        </a>
        <a href="{{ url_for('location-hub') }}" class="button">
            <i class="fas fa-map-marker-alt"></i> Location Hub
        </a>
        <a href="{{ url_for('actions') }}" class="button">
            <i class="fas fa-bolt"></i> Actions
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='jquery-3.7.1.min.js') }}"></script>
<script src="{{ url_for('static', filename='main.js') }}"></script>
<script src="{{ url_for('static', filename='chat.js') }}"></script>
{% endblock %}